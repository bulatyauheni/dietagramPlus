package bulat.diet.helper_ru.activity;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.TextView;
import bulat.diet.helper_ru.R;
import bulat.diet.helper_ru.utils.MessagesUpdater;

public class BaseActivity extends Activity {
	public static final String CUSTOM_INTENT = "bulat.intent";
	Handler myHandler ;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		View viewToLoad = LayoutInflater.from(this.getParent()).inflate(
				R.layout.social_user_list, null);
		
		myHandler = new Handler() {
            @Override
            public void handleMessage (Message msg) {
            	Bundle b = msg.getData();
                String message = b.getString("message");
                updateMessageCount(message);
            }
		};
		super.onCreate(savedInstanceState);
	}
	protected void updateMessageCount(String message) {
		// TODO Auto-generated method stub
		 DietHelperActivity parentActivity;
	        parentActivity = (DietHelperActivity) this.getParent().getParent();
	        parentActivity.changeSocialTabIndicator(3, message);
	     TextView tv = (TextView) findViewById(R.id.textViewMessNumber);
	     if(tv!=null){
		     if(!"0".equals(message)){
		    	 tv.setText(" (" +message+ ")");
				}else{
					tv.setText("");
				}
	     }
	}
	
	@Override
	protected void onResume() {
		// TODO Auto-generated method stub
		super.onResume();
		// TODO Auto-generated method stub
		new MessagesUpdater(this, myHandler).execute();
		Intent i = new Intent();
		i.setAction(CUSTOM_INTENT);
		this.sendBroadcast(i);
	}
	@Override
	protected void onStop() {
		// TODO Auto-generated method stub
		super.onStop();
		Intent i = new Intent();
		i.setAction(CUSTOM_INTENT);
		this.sendBroadcast(i);
	}
}
